@using Microsoft.AspNetCore.Authorization
@using WEB_153502_KIRZNER.BlazorWasm.Pages

@page "/fetchdata"
@page "/fetchdata/{category}"

@attribute [Authorize]

@inject HttpClient Http
@inject IDataService dataService


<PageTitle>Products</PageTitle>

<h1>Продукты</h1>

<CategorySelector SelectedCategory="@SelectedName" />

<ProductsList/>

<Pager Category="@Category"/>

@code {
    [Inject]
    public IDataService DataService { get; set; }

    [Parameter]
    public string Category { get; set; }

    public string SelectedName { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await DataService.GetProductListAsync(Category);
        await DataService.GetCategoryListAsync();
        if (Category != null)
            SelectedName = DataService
            .Categories
            .FirstOrDefault(c =>
            c.NormalizedName.Equals(Category))
            .Name;
        else SelectedName = "Все";
    }
}
